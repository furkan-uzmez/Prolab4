<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toplu Taşıma Durakları Haritası</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap}">
    <link href="https://fonts.googleapis.com/css2?family=Sen:wght@400;700;800&display=swap" rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Sen:wght@400;700;800&display=swap}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>


<div class="top-bar">
    <h1>📍 Toplu Taşıma Durakları</h1>
    <div class="search-bar">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Lokasyon ara (örn: İstanbul)">
            <span class="search-icon" id="searchButton">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </span>
        </div>
        <div class="tooltip">Konumu Haritada Ara</div>
    </div>
    <div class="top-bar-controls">
        <button class="control-btn" id="modeToggle" title="Karanlık Mod">☀</button>
        <div class="tooltip">Karanlık/Açık Mod</div>
        <button class="control-btn" id="resetMap" title="Haritayı Sıfırla">⟳</button>
        <div class="tooltip">Haritayı Sıfırla</div>
        <button class="control-btn" id="getLocation" title="Konumumu Bul">📍</button>
        <div class="tooltip">Konumumu Bul</div>
    </div>
</div>

<div class="container">
    <div class="form-container">
        <h2>Konum Bilgileri</h2>
        <form method="POST" id="locationForm" th:action="@{/}">
            <div class="input-group">
                <label for="baslangic_enlem">Başlangıç Enlemi:</label>
                <input type="text" name="baslangic_enlem" id="baslangic_enlem" placeholder="Örn: 40.7669" required  >
            </div>
            <div class="input-group">
                <label for="baslangic_boylam">Başlangıç Boylamı:</label>
                <input type="text" name="baslangic_boylam" id="baslangic_boylam"  placeholder="Örn: 29.9169" required>
            </div>
            <div class="input-group">
                <label for="hedef_enlem">Hedef Enlemi:</label>
                <input type="text" name="hedef_enlem" id="hedef_enlem"  placeholder="Örn: 40.7769" required>
            </div>
            <div class="input-group">
                <label for="hedef_boylam">Hedef Boylamı:</label>
                <input type="text" name="hedef_boylam" id="hedef_boylam"  placeholder="Örn: 29.9269" required>
            </div>
            <div class="form-btn-wrapper">
                <button type="submit" class="form-btn"><span>Konumları Göster</span><div class="spinner"></div></button>
                <div class="tooltip">Konumları Haritada Göster</div>
            </div>

            <div class="input-group">
                <label for="odeme_yontemi">Ödeme Yöntemi:</label>
                <select name="odeme_yontemi" id="odeme_yontemi" required>
                    <option value="" disabled selected>Ödeme yöntemi seçin</option>
                    <option value="nakit">Nakit</option>
                    <option value="kredi_karti">Kredi Kartı</option>
                    <option value="kentkart">Kentkart</option>
                </select>
            </div>

            <div class="input-group">
                <label for="yolcu_turu">Yolcu Türü:</label>
                <select name="yolcu_turu" id="yolcu_turu" required>
                    <option value="" disabled selected>Yolcu türünü seçin</option>
                    <option value="genel">Genel</option>
                    <option value="ogrenci">Öğrenci</option>
                    <option value="yasli">Yaşlı</option>
                </select>
            </div>

            <div class="input-group">
                <label for="bakiye">Bakiye:</label>
                <input type="text" name="bakiye" id="bakiye" th:value="${bakiye}" placeholder="Örn: 1000.50" required>
            </div>
        </form>



        <div th:if="${hata}" class="error" th:text="${hata}"></div>

        <div class="coordinate-display">
            <p>Tıklayarak Konum Seç:</p>
            <p>Seçilen: <span id="selected-coordinates">Henüz seçilmedi</span></p>
            <div class="quick-actions">
                <div class="quick-btn-wrapper">
                    <button class="quick-btn" id="set-start">Başlangıç Yap</button>
                    <div class="tooltip">Seçileni Başlangıç Olarak Ayarla</div>
                </div>
                <div class="quick-btn-wrapper">
                    <button class="quick-btn" id="set-destination">Hedef Yap</button>
                    <div class="tooltip">Seçileni Hedef Olarak Ayarla</div>
                </div>
            </div>
        </div>

        <div class="legend">
            <h3>Durak Türleri</h3>
            <div class="legend-item">
                <img src="https://img.icons8.com/color/48/000000/bus.png" alt="Otobüs" class="legend-icon" th:src="@{https://img.icons8.com/color/48/000000/bus.png}">
                Otobüs Durağı
            </div>
            <div class="legend-item">
                <img src="https://img.icons8.com/color/48/000000/tram.png" alt="Tramvay" class="legend-icon" th:src="@{https://img.icons8.com/color/48/000000/tram.png}">
                Tramvay Durağı
            </div>
        </div>

        <div class="quick-actions">
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="zoomIn">Yakınlaştır</button>
                <div class="tooltip">Haritayı Yakınlaştır</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="zoomOut">Uzaklaştır</button>
                <div class="tooltip">Haritayı Uzaklaştır</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="clearMarkers">İşaretleri Temizle</button>
                <div class="tooltip">Tüm İşaretleri Kaldır</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="filter-bus">Sadece Otobüs</button>
                <div class="tooltip">Yalnızca Otobüs Duraklarını Göster</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="filter-tram">Sadece Tramvay</button>
                <div class="tooltip">Yalnızca Tramvay Duraklarını Göster</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="filter-all">Tüm Duraklar</button>
                <div class="tooltip">Tüm Durakları Göster</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="saveRoute">Rotayı Kaydet</button>
                <div class="tooltip">Mevcut Rotayı Kaydet</div>
            </div>
        </div>



        <div class="status-bar" id="status-bar">
            Durum: Harita Yüklendi
        </div>

        <div class="theme-toggle-info" id="theme-info">
            Tema: Açık Mod
        </div>
    </div>

    <div class="map-container">
        <div id="map"></div>
    </div>
</div>

<!-- Değişkenleri HTML’de tanımlayın -->
<script th:inline="javascript">
    window.duraklar = /*[[${duraklar}]]*/ [];
    window.googleMapsApiKey = /*[[${googleMapsApiKey}]]*/ null;

    // Hata ayıklama için
    console.log("Backend'den gelen değerler:");
    console.log("durakVerisi:", window.durakVerisi);
    console.log("googleMapsApiKey:", window.googleMapsApiKey);
</script>

<script th:inline="javascript">
    window.durakVerisi = JSON.parse(/*[[${duraklar != null ? duraklar : '[]'}]]*/ '[]');
</script>

<script th:src="@{js/script.js}"></script>
<script th:src="@{https://maps.googleapis.com/maps/api/js(key=${googleMapsApiKey},libraries=geometry,callback=initMap,loading=async)}" async defer></script>
</body>
</html>