<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toplu TaÅŸÄ±ma DuraklarÄ± HaritasÄ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap}">
    <link href="https://fonts.googleapis.com/css2?family=Sen:wght@400;700;800&display=swap" rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Sen:wght@400;700;800&display=swap}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>


<div class="top-bar">
    <h1>ğŸ“ Toplu TaÅŸÄ±ma DuraklarÄ±</h1>
    <div class="search-bar">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Lokasyon ara (Ã¶rn: Ä°stanbul)">
            <span class="search-icon" id="searchButton">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </span>
        </div>
        <div class="tooltip">Konumu Haritada Ara</div>
    </div>
    <div class="top-bar-controls">
        <button class="control-btn" id="modeToggle" title="KaranlÄ±k Mod">â˜€</button>
        <div class="tooltip">KaranlÄ±k/AÃ§Ä±k Mod</div>
        <button class="control-btn" id="resetMap" title="HaritayÄ± SÄ±fÄ±rla">âŸ³</button>
        <div class="tooltip">HaritayÄ± SÄ±fÄ±rla</div>
        <button class="control-btn" id="getLocation" title="Konumumu Bul">ğŸ“</button>
        <div class="tooltip">Konumumu Bul</div>
    </div>
</div>

<div class="container">
    <div class="form-container">
        <h2>Konum Bilgileri</h2>
        <form method="POST" id="locationForm" th:action="@{/}">
            <div class="input-group">
                <label for="baslangic_enlem">BaÅŸlangÄ±Ã§ Enlemi:</label>
                <input type="text" name="baslangic_enlem" id="baslangic_enlem" placeholder="Ã–rn: 40.7669" required  >
            </div>
            <div class="input-group">
                <label for="baslangic_boylam">BaÅŸlangÄ±Ã§ BoylamÄ±:</label>
                <input type="text" name="baslangic_boylam" id="baslangic_boylam"  placeholder="Ã–rn: 29.9169" required>
            </div>
            <div class="input-group">
                <label for="hedef_enlem">Hedef Enlemi:</label>
                <input type="text" name="hedef_enlem" id="hedef_enlem"  placeholder="Ã–rn: 40.7769" required>
            </div>
            <div class="input-group">
                <label for="hedef_boylam">Hedef BoylamÄ±:</label>
                <input type="text" name="hedef_boylam" id="hedef_boylam"  placeholder="Ã–rn: 29.9269" required>
            </div>
            <div class="form-btn-wrapper">
                <button type="submit" class="form-btn"><span>KonumlarÄ± GÃ¶ster</span><div class="spinner"></div></button>
                <div class="tooltip">KonumlarÄ± Haritada GÃ¶ster</div>
            </div>

            <div class="input-group">
                <label for="odeme_yontemi">Ã–deme YÃ¶ntemi:</label>
                <select name="odeme_yontemi" id="odeme_yontemi" required>
                    <option value="" disabled selected>Ã–deme yÃ¶ntemi seÃ§in</option>
                    <option value="nakit">Nakit</option>
                    <option value="kredi_karti">Kredi KartÄ±</option>
                    <option value="kentkart">Kentkart</option>
                </select>
            </div>

            <div class="input-group">
                <label for="yolcu_turu">Yolcu TÃ¼rÃ¼:</label>
                <select name="yolcu_turu" id="yolcu_turu" required>
                    <option value="" disabled selected>Yolcu tÃ¼rÃ¼nÃ¼ seÃ§in</option>
                    <option value="genel">Genel</option>
                    <option value="ogrenci">Ã–ÄŸrenci</option>
                    <option value="yasli">YaÅŸlÄ±</option>
                </select>
            </div>

            <div class="input-group">
                <label for="bakiye">Bakiye:</label>
                <input type="text" name="bakiye" id="bakiye" th:value="${bakiye}" placeholder="Ã–rn: 1000.50" required>
            </div>
        </form>



        <div th:if="${hata}" class="error" th:text="${hata}"></div>

        <div class="coordinate-display">
            <p>TÄ±klayarak Konum SeÃ§:</p>
            <p>SeÃ§ilen: <span id="selected-coordinates">HenÃ¼z seÃ§ilmedi</span></p>
            <div class="quick-actions">
                <div class="quick-btn-wrapper">
                    <button class="quick-btn" id="set-start">BaÅŸlangÄ±Ã§ Yap</button>
                    <div class="tooltip">SeÃ§ileni BaÅŸlangÄ±Ã§ Olarak Ayarla</div>
                </div>
                <div class="quick-btn-wrapper">
                    <button class="quick-btn" id="set-destination">Hedef Yap</button>
                    <div class="tooltip">SeÃ§ileni Hedef Olarak Ayarla</div>
                </div>
            </div>
        </div>

        <div class="legend">
            <h3>Durak TÃ¼rleri</h3>
            <div class="legend-item">
                <img src="https://img.icons8.com/color/48/000000/bus.png" alt="OtobÃ¼s" class="legend-icon" th:src="@{https://img.icons8.com/color/48/000000/bus.png}">
                OtobÃ¼s DuraÄŸÄ±
            </div>
            <div class="legend-item">
                <img src="https://img.icons8.com/color/48/000000/tram.png" alt="Tramvay" class="legend-icon" th:src="@{https://img.icons8.com/color/48/000000/tram.png}">
                Tramvay DuraÄŸÄ±
            </div>
        </div>

        <div class="quick-actions">
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="zoomIn">YakÄ±nlaÅŸtÄ±r</button>
                <div class="tooltip">HaritayÄ± YakÄ±nlaÅŸtÄ±r</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="zoomOut">UzaklaÅŸtÄ±r</button>
                <div class="tooltip">HaritayÄ± UzaklaÅŸtÄ±r</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="clearMarkers">Ä°ÅŸaretleri Temizle</button>
                <div class="tooltip">TÃ¼m Ä°ÅŸaretleri KaldÄ±r</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="filter-bus">Sadece OtobÃ¼s</button>
                <div class="tooltip">YalnÄ±zca OtobÃ¼s DuraklarÄ±nÄ± GÃ¶ster</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="filter-tram">Sadece Tramvay</button>
                <div class="tooltip">YalnÄ±zca Tramvay DuraklarÄ±nÄ± GÃ¶ster</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="filter-all">TÃ¼m Duraklar</button>
                <div class="tooltip">TÃ¼m DuraklarÄ± GÃ¶ster</div>
            </div>
            <div class="quick-btn-wrapper">
                <button class="quick-btn" id="saveRoute">RotayÄ± Kaydet</button>
                <div class="tooltip">Mevcut RotayÄ± Kaydet</div>
            </div>
        </div>



        <div class="status-bar" id="status-bar">
            Durum: Harita YÃ¼klendi
        </div>

        <div class="theme-toggle-info" id="theme-info">
            Tema: AÃ§Ä±k Mod
        </div>
    </div>

    <div class="map-container">
        <div id="map"></div>
    </div>
</div>

<!-- DeÄŸiÅŸkenleri HTMLâ€™de tanÄ±mlayÄ±n -->
<script th:inline="javascript">
    window.duraklar = /*[[${duraklar}]]*/ [];
    window.googleMapsApiKey = /*[[${googleMapsApiKey}]]*/ null;

    // Hata ayÄ±klama iÃ§in
    console.log("Backend'den gelen deÄŸerler:");
    console.log("durakVerisi:", window.durakVerisi);
    console.log("googleMapsApiKey:", window.googleMapsApiKey);
</script>

<script th:inline="javascript">
    window.durakVerisi = JSON.parse(/*[[${duraklar != null ? duraklar : '[]'}]]*/ '[]');
</script>

<script th:src="@{js/script.js}"></script>
<script th:src="@{https://maps.googleapis.com/maps/api/js(key=${googleMapsApiKey},libraries=geometry,callback=initMap,loading=async)}" async defer></script>
</body>
</html>